# Memoize.md

**Memoize.md** is a personal, "headless" Spaced Repetition System (SRS). It is designed for developers
who treat Markdown as the Source of Truth.

It decouples your content (Markdown files in a private git repo) from your learning state (FSRS
intervals in a database), allowing you to write notes in Obsidian and review them in a dedicated web
app.

## High-Level Architecture

The system operates on a "Push" model. The Web App never writes to your Markdown files; it only
reads them.

```mermaid
graph TD
    User[You] -->|Write| Obsidian[Obsidian / VS Code]
    Obsidian -->|Push| GitHub[Private Content Repo]
    GitHub -->|Trigger| Action[GitHub Action (Sync Script)]
    Action -->|Upsert/Suspend| DB[(Supabase DB)]
    WebApp[Next.js Web App] -->|Fetch Due Cards| DB
    WebApp -->|Save FSRS State| DB
```

1.  **Content Source:** A private GitHub repository containing your `.md` files.
2.  **The Brain (Sync):** A script that runs on `git push`. It parses files, generates card IDs
    (hashes), and performs a "Reconciliation" (Insert/Update/Suspend) with Supabase.
3.  **The State:** Supabase (PostgreSQL) stores the card metadata and FSRS algorithm parameters
    (Stability, Difficulty, etc.).
4.  **The Client:** A Next.js 16 app used exclusively for reviewing.

## Syntax & Card Modes

Memoize.md supports two parsing modes defined by YAML frontmatter.

### Mode 1: Concept Cards (Default)

*   One File = One Card
*   ID Strategy: The Filename (e.g., `20251215193532.md`). *Renaming the file resets the card history.*

**Example:** `20251215193532.md`

```markdown
---
tags: [react, frontend]
reverse: true
---

# useEffect

The {useEffect} hook handles side effects in functional components.
```

*Result:*

1.  **Front:** `useEffect` | **Back:** `The {useEffect} hook...`
2.  (Because `reverse: true`) **Front:** `The ... hook handles side effects...` | **Back:** `useEffect`

---

### Mode 2: Vocab Lists (`list: true`)

Best for languages and rapid-fire definitions.

*   One File = Many Cards
*   ID Strategy: Hash of the Question text. *Fixing a typo in the Question resets history.*

**Example:** `french.md`

```markdown
---
list: true
tags: [french]
---

# Food
Apple :: Pomme
To Eat <::> Manger
```

*Result:*
1.  **Basic:** Apple -> Pomme
2.  **Reverse:** To Eat -> Manger
3.  **Reverse:** Manger -> To Eat (generated by `<::>`)

## Local Development Setup

To develop the **Web App** or test the **Sync Logic** locally:

### Prerequisites

*   Node.js 20+
*   A Supabase project (Free tier is fine).

### Database Setup

Run the following SQL in your Supabase SQL Editor to create the schema and enable FSRS tracking:

```sql
create extension if not exists "pgcrypto";

create table cards (
  id uuid primary key default gen_random_uuid(),
  user_id uuid references auth.users not null,
  source_filepath text not null, 
  card_anchor text not null,
  card_type text not null, 
  front text not null,
  back text not null,

  -- FSRS v5 State
  state int default 0,
  stability float default 0,
  difficulty float default 0,
  elapsed_days int default 0,
  scheduled_days int default 0,
  reps int default 0,
  
  due_date timestamptz default now(),
  last_review timestamptz,
  is_suspended boolean default false,
  created_at timestamptz default now(),
  updated_at timestamptz default now(),

  unique (user_id, source_filepath, card_anchor, card_type)
);

alter table cards enable row level security;
create policy "Users can only see their own cards" on cards for all using (auth.uid() = user_id);
```

### Environment Variables

Create `.env.local` in the root:

```bash
# Frontend
NEXT_PUBLIC_SUPABASE_URL="https://your-project.supabase.co"
NEXT_PUBLIC_SUPABASE_ANON_KEY="your-anon-key"

# Sync Script (Backend)
SUPABASE_SERVICE_ROLE_KEY="your-service-role-key"  # Project Settings -> API
USER_ID="your-user-uuid"                           # Authentication -> Users
CONTENT_DIR="./content-mock"                       # Directory to parse locally
```

### Mocking Content

1.  Create a folder named `content-mock` in the root.
2.  Add a Markdown file inside (e.g., `test.md`) with the syntax described above.

### Running the Sync

This simulates the GitHub Action running on your local machine. It will read `content-mock` and push cards to your real Supabase DB.

```bash
pnpm install
pnpm run sync
```

### Running the Web App

```bash
pnpm run dev
```

Open `http://localhost:3000`. You should see the cards generated from your mock content.

## Deployment

1.  **Web App:** Deploy this repo (`memoizemd`) to Vercel.
2.  **Sync Engine (Your Content):**
    *   Create a separate private repository for your notes (e.g., `my-brain`).
    *   Create a file `.github/workflows/sync.yml` in that repository.
    *   Copy the content from `content-sync.yml.template` in this repo into that file.
    *   **Settings -> Secrets and variables -> Actions:** Add the following repository secrets:
        *   `SUPABASE_URL`
        *   `SUPABASE_SERVICE_ROLE_KEY` (Service Role Key, NOT Anon Key)
        *   `USER_ID` (Your User UUID from Supabase Auth)